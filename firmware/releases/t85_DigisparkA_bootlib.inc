# Makefile include for use micronucleus bootloader as usb library 

micronusblib.ld:
	$(file >$@,/* auto generated by micronusblib.inc dont modify */)
	$(file >>$@,PROVIDE(calibrateOscillatorASM = 0x00001cee);)
	$(file >>$@,PROVIDE(usbCrc16 = 0x000019ce);)
	$(file >>$@,PROVIDE(usbCrc16Append = 0x000019f8);)
	$(file >>$@,PROVIDE(micronucleusInt = 0x00001a00);)
	$(file >>$@,)
	$(file >>$@,PROVIDE(usbBootVarEnd = 0x008000a6);)
	$(file >>$@,PROVIDE(usbBootReserved = 0x00800060);)
	$(file >>$@,PROVIDE(usbConfiguration = 0x00800083);)
	$(file >>$@,PROVIDE(usbCurrentTok = 0x00800082);)
	$(file >>$@,PROVIDE(usbDeviceAddr = 0x00800078);)
	$(file >>$@,PROVIDE(usbInputBufOffset = 0x0080007a);)
	$(file >>$@,PROVIDE(usbMsgPtr = 0x0080007e);)
	$(file >>$@,PROVIDE(usbNewDeviceAddr = 0x00800081);)
	$(file >>$@,PROVIDE(usbRxBuf = 0x00800084);)
	$(file >>$@,PROVIDE(usbRxLen = 0x00800080);)
	$(file >>$@,PROVIDE(usbRxToken = 0x00800079);)
	$(file >>$@,PROVIDE(usbSofCount = 0x0080007d);)
	$(file >>$@,PROVIDE(usbTxBuf = 0x00800061);)
	$(file >>$@,PROVIDE(usbTxLen = 0x0080007c);)
	$(file >>$@,PROVIDE(usbTxStatus1 = 0x0080006c);)
	$(file >>$@,PROVIDE(usbTxStatus3 = 0x0080009a);)
	$(file >>$@,)
	$(file >>$@,SECTIONS)
	$(file >>$@,{)
	$(file >>$@,  usbbv.data : AT (0x00800060))
	$(file >>$@,  {)
	$(file >>$@,    KEEP (*(usbbv.data)))
	$(file >>$@,  })
	$(file >>$@,})

CFLAGS += -DUSBRESERVERDDATA=0x008000a6-0x00800060 -DHAVEUSBLIB=1
MCUARCH = avr25
LDFLAGS += -T micronusblib.ld -T ldscripts/$(MCUARCH).x
LDDEPENDS += micronusblib.ld

